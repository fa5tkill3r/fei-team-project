---
import { parse } from 'marked'
import { astroI18n, createGetStaticPaths } from 'astro-i18n'
import Layout from '../../layouts/Layout.astro'
import { getPostsByLanguage } from '../../lib/data'
import type Post from '../../interfaces/Post'
import type Translation from '../../interfaces/Translation'
import Footer from '../../components/Footer.astro'

export const getStaticPaths = createGetStaticPaths(async () => {
  const posts = await getPostsByLanguage(astroI18n.locale)

  return posts.flatMap((post) =>
    post.translations.map((translation) => ({
      params: { slug: post.slug },
      props: {
        post,
        translation,
      },
    })),
  )
})

interface Props {
  post: Post
  translation: Translation
}

const p = Astro.props
---

<Layout title={p.translation.title}>

  <main class="max-w-4xl mx-auto px-2">
    <article class="max-w-4xl m-auto px-2 my-10">
      <h1 class="text-3xl mb-3">{p.translation.title}</h1>
      <article class="prose" set:html={parse(p.translation.content)} />
    </article>
  </main>

  <Footer />
</Layout>
